<p-toast></p-toast>
<div class="row mb-4">
  <div class="col">
    <div widget class="card border-0 box-shadow">
      <div class="card-body widget-body border-1">
        <div class="row">
          <div class="col-sm-12 col-lg-12 col-md-12">
            <p-autoComplete [(ngModel)]="numeroInterne" [suggestions]="filteredEtudiants"
              (completeMethod)="searchEtudiant($event)" [size]="50" [minLength]="1" [field]="'unbounded'"
              placeholder="Saisir un numéro de dossier">
              <ng-template let-etudiant pTemplate="item">
                <div class="ui-helper-clearfix" (click)="displayMedicalFile(etudiant)"
                  style="border-bottom:1px solid #D5D5D5">
                  <img src="{{ etudiant?.photoLink || 'assets/icons/folder-icon.svg' }}"
                    style="width:32px;display:inline-block;margin:5px 0 2px 5px" />
                  <div style="font-size:18px;float:right;margin:10px 10px 0 0">
                    {{ etudiant?.prenometudiant }}
                    {{ etudiant?.nometudiant | uppercase }} </div>
                </div>
              </ng-template>
            </p-autoComplete>
            <div *ngIf="searchInputTouched && !searching && !filteredEtudiants.length && numeroInterne"
              class="alert alert-danger mt-3 text-white" role="alert">
              Aucun n'étudiant n'a été trouvé avec le numéro de dossier indiqué pour l'année
              {{ anneeEnCours?.libelleanneeacad }}.
            </div>
          </div>
        </div>

        <div class="row mt-5" *ngIf="selectedInscriptionacad">
          <div class="col-sm-6 col-lg-6 col-md-6">
            <div class="card">
              <div class="card-body">
                <table class="table table-responsive-sm table-responsive-md table-responsive-lg table-hover">
                  <tbody>
                    <tr>
                      <th>Prenom</th>
                      <td>
                        {{ selectedInscriptionacad?.idetudiant?.prenometudiant }}
                      </td>
                      <th>Filiere</th>
                      <td>
                        {{ selectedInscriptionacad?.idclasse?.idfiliere?.libellefiliere }}
                      </td>
                    </tr>
                    <tr>
                      <th>Nom</th>
                      <td>
                        {{ selectedInscriptionacad?.idetudiant?.nometudiant }}
                      </td>
                      <th>Niveau</th>
                      <td>
                        {{ selectedInscriptionacad?.idclasse?.idniveau?.libelleniveau }}
                      </td>
                    </tr>
                    <tr>

                      <th>Genre</th>
                      <td>
                        <ng-container [ngSwitch]="selectedInscriptionacad?.idetudiant?.genre">
                          <span *ngSwitchCase="'F'">
                            <span class="badge badge-primary" style="font-size: 15px;">
                              <i class="fa fa-female"></i>&nbsp;Femme
                            </span>
                          </span>
                          <span *ngSwitchCase="'M'">
                            <span class="badge badge-primary" style="font-size: 15px;">
                              <i class="fa fa-male"></i>&nbsp;Homme
                            </span>
                          </span>
                        </ng-container>
                      </td>

                      <th>Date Inscription</th>
                      <td>
                        {{ selectedInscriptionacad?.dateinscacad | date: 'dd/MM/yyyy'}}
                      </td>

                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <div class="col-sm-6 col-lg-6 col-md-6">
            <div class="card">
              <div class="card-body">
                <div class="row">

                  <div class="col-12">
                    <div class="form-group">
                      <label for="dateVisiteMedical">Date consultation</label>
                      <div class="input-group ">
                        <input class="form-control" placeholder="Saisir la date de la consultation" name="dp"
                          [(ngModel)]="dateConsultation" id="dateVisiteMedical" ngbDatepicker #d="ngbDatepicker">
                        <div class="input-group-append">
                          <button class="btn btn-outline-secondary" (click)="d.toggle()" type="button">
                            <i class="fa fa-calendar" aria-hidden="true"></i>
                          </button>
                        </div>
                      </div>
                    </div>

                  </div>


                  <div class="col-12">
                    <div class="form-group">
                      <label class="col-form-label form-control-label" for="handicap">Résultat de la visite</label>
                      <p-selectButton [style]="{'width':'100%'}" [options]="statuts" [(ngModel)]="selectedApte"
                        optionLabel="label" name="handicap" id="handicap"></p-selectButton>
                    </div>
                  </div>

                  <div class="col-md-12 col-lg-12">
                    <div class="form-group">
                      <label lass="col-form-label form-control-label" for="commentaire">Commentaires <b class="text-danger">(non visible pour l'université)</b></label>
                      <p-editor name="commentaire" [(ngModel)]="visiteMedicale.commentaire" required
                        [style]="{'height':'200px'}">
                      </p-editor>
                    </div>
                  </div>

                  <div class="col-md-12 col-lg-12 d-flex justify-content-end">
                    <ng-container [ngSwitch]="selectedInscriptionacad.visiteMedicale === null">
                      <button *ngSwitchCase="true" type="button" class="btn btn-primary" (click)="save()">
                        Enregistrer la visite
                        <i class="fa fa-check-circle" aria-hidden="true"></i>
                      </button>

                      <button *ngSwitchCase="false" type="button" class="btn btn-primary" (click)="update()">
                        Mettre à jour
                        <i class="fa fa-check-circle" aria-hidden="true"></i>
                      </button>

                    </ng-container>

                  </div>
                  

                  <div class="col-md-6 col-lg-6">
                    <div class="form-group">
                      <label class="col-form-label form-control-label" for="presenceHandicap">Présence Handicap</label>
                      <p-selectButton [style]="{'width':'100%'}" [options]="presenceHandicaps"
                        [(ngModel)]="selectedPresenceHandicap" optionLabel="label" name="presenceHandicap"
                        id="presenceHandicap"></p-selectButton>
                    </div>
                  </div>

                  <div class="col-md-6 col-lg-6" *ngIf="selectedPresenceHandicap.value === 'Oui'">
                    <div class="form-group">
                      <label class="col-form-label form-control-label" for="typeHandicap">Type
                        Handicap</label><br>
                      <p-dropdown [style]="{'width':'100%'}" [options]="handicapTypes" [(ngModel)]="selectedHandicap"
                        placeholder="Selectionner type handicap" optionLabel="libelle" [showClear]="true"
                        name="typeHandicap" id="typeHandicap">
                      </p-dropdown>
                    </div>
                  </div>

                  <div class="col-md-12 col-lg-12" *ngIf="selectedPresenceHandicap.value === 'Oui'">
                    <div class="form-group">
                      <label lass="col-form-label form-control-label" for="message">Commentaires sur l'handicap</label>
                      <textarea [(ngModel)]="selectedInscriptionacad.idetudiant.descriptionHandicap"
                        class="form-control" name="" id="" rows="3"></textarea>
                    </div>
                  </div>

                  <div class="col-md-12 col-lg-12 d-flex justify-content-end">
                    <button type="button" class="btn btn-primary" (click)="updateEtudiantInfos()">
                      Mettre à jour
                      <i class="fa fa-check-circle" aria-hidden="true"></i>
                    </button>
                  </div>

                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>